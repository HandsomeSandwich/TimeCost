{% extends "base.html" %}
{% block title %}Tap{% endblock %}
{% block body_class %}kiosk{% endblock %}

{% block content %}
<div class="kiosk-wrap">
  <h1 class="kiosk-title">Tap your card</h1>
  <p class="kiosk-subtitle">Ready when you are.</p>

  {% include "partials/_guide_bubble.html" with context %}
  {# guide_line can be optional on this screen #}

  <div class="tap-orb" aria-hidden="true"></div>

  <form class="tap-form" action="{{ url_for('tap') }}" method="post" autocomplete="off">
    <label class="sr-only" for="card_uid">Card UID</label>
    <input
      id="card_uid"
      name="card_uid"
      class="tap-input"
      type="text"
      inputmode="none"
      autocomplete="off"
      autofocus
      required
    />
    <button class="sr-only" type="submit">Submit</button>
  </form>

  <p class="kiosk-hint">Tip: keep this page open. Just tap and go.</p>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Keep focus on the hidden input so USB NFC readers "type" into it.
  (function () {
    const input = document.getElementById("card_uid");
    if (!input) return;

    function refocus() {
      input.focus({ preventScroll: true });
    }

    // Focus now and keep it.
    refocus();
    document.addEventListener("click", refocus);
    window.addEventListener("focus", refocus);

    // Most HID readers send an Enter at end. Submit when we see it.
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        input.form.submit();
      }
    });
  })();
</script>
{% endblock %}
