<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}TimeCost{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  {% block head %}{% endblock %}
</head>

<body>
  <header>
    <h1>TimeCost</h1>
  </header>

  <nav class="navbar">
    <button
      class="nav-toggle"
      aria-label="Open menu"
      aria-controls="mobile-drawer"
      aria-expanded="false">
      ☰
    </button>

    <div class="nav-links">
      {% include "partials/_nav_links.html" %}
    </div>

    <div class="nav-right">
      {% include "partials/_nav_controls.html" %}
      {% block nav_right %}{% endblock %}
    </div>
  </nav>

  <div id="drawer-backdrop" class="drawer-backdrop" hidden></div>

  <aside id="mobile-drawer" class="drawer" hidden>
    <div class="drawer-header">
      <strong>Menu</strong>
      <button class="drawer-close" aria-label="Close menu">✕</button>
    </div>

    {% include "partials/_nav_links.html" %}
    {% include "partials/_nav_controls.html" %}
  </aside>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer>
    <p>&copy; TimeCost</p>
  </footer>

  <script>
    (function () {
      const toggle = document.querySelector(".nav-toggle");
      const drawer = document.getElementById("mobile-drawer");
      const backdrop = document.getElementById("drawer-backdrop");
      const closeBtn = drawer?.querySelector(".drawer-close");

      function openDrawer() {
        if (!drawer.hidden) return;
        drawer.hidden = false;
        backdrop.hidden = false;
        toggle.setAttribute("aria-expanded", "true");
        document.body.classList.add("drawer-open");
        closeBtn?.focus();
      }

      function closeDrawer() {
        if (drawer.hidden) return;
        drawer.hidden = true;
        backdrop.hidden = true;
        toggle.setAttribute("aria-expanded", "false");
        document.body.classList.remove("drawer-open");
        toggle?.focus();
      }

      toggle?.addEventListener("click", () => {
        toggle.getAttribute("aria-expanded") === "true"
          ? closeDrawer()
          : openDrawer();
      });

      closeBtn?.addEventListener("click", closeDrawer);
      backdrop?.addEventListener("click", closeDrawer);

      drawer?.querySelectorAll("a, form").forEach(el =>
        el.addEventListener("click", closeDrawer)
      );

      document.addEventListener("keydown", e => {
        if (e.key === "Escape") closeDrawer();
      });

      function closeIfDesktop() {
        if (window.matchMedia("(min-width: 721px)").matches) {
          closeDrawer();
        }
      }

      window.addEventListener("resize", closeIfDesktop);
      closeIfDesktop();
    })();
  </script>
</body>
</html>
