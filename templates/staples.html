{% extends "base.html" %}
{% block title %}Staples - Time Cost{% endblock %}
{% block head %}
  <style>
    .form-container { max-width: 800px; margin: 0 auto; text-align: left; }
    .form-container table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .form-container table, .form-container th, .form-container td { border: 1px solid #ccc; }
    .form-container th, .form-container td { padding: 10px; text-align: left; }
    .form-container input[type="text"], .form-container input[type="number"] {
      width: 100%; padding: 5px; box-sizing: border-box;
    }
    .form-container button {
      padding: 8px 15px; margin-top: 10px; cursor: pointer;
      background-color: #333; color: #fff; border: none; border-radius: 4px;
    }
    .form-container button:hover { background-color: #555; }
    label { font-weight: bold; margin-bottom: 5px; display: block; }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function(){
      const stapleTableBody = document.getElementById("stapleTableBody");
      const hourlyRateInput = document.getElementById("stapleHourlyRate");

      function recalcRow(row) {
        const costInput = row.querySelector(".stapleCost");
        const timeSpan = row.querySelector(".stapleTime");
        const cost = parseFloat(costInput.value) || 0;
        const rate = parseFloat(hourlyRateInput.value) || 0;
        const timeCost = (rate > 0) ? cost / rate : 0;
        timeSpan.textContent = timeCost.toFixed(2);
      }

      function recalcTotals(){
        let totalCost = 0;
        let totalTime = 0;
        const rate = parseFloat(hourlyRateInput.value) || 0;

        document.querySelectorAll("#stapleTableBody tr").forEach(function(row){
          const cost = parseFloat(row.querySelector(".stapleCost").value) || 0;
          totalCost += cost;
          totalTime += (rate > 0 ? cost / rate : 0);
        });

        document.getElementById("totalCost").textContent = totalCost.toFixed(2);
        document.getElementById("totalTime").textContent = totalTime.toFixed(2);
      }

      function addCostListener(row) {
        const costInput = row.querySelector(".stapleCost");
        costInput.addEventListener("input", function(){
          recalcRow(row);
          recalcTotals();
        });
      }

      function addStapleRow(itemName = "", costValue = ""){
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="text" class="stapleName" value="${itemName}" placeholder="e.g. Milk" required></td>
          <td><input type="number" step="0.01" class="stapleCost" value="${costValue}" placeholder="0.00" required></td>
          <td><span class="stapleTime">0.00</span></td>
          <td><button type="button" class="removeStaple">Remove</button></td>
        `;

        row.querySelector(".removeStaple").addEventListener("click", function(){
          row.remove();
          recalcTotals();
        });

        addCostListener(row);
        stapleTableBody.appendChild(row);
        recalcRow(row);
        recalcTotals();
      }

      hourlyRateInput.addEventListener("input", function(){
        document.querySelectorAll("#stapleTableBody tr").forEach(recalcRow);
        recalcTotals();
      });

      document.getElementById("addStapleBtn").addEventListener("click", function(){
        addStapleRow();
      });

      // Start simple: one empty row
      addStapleRow();
    });
  </script>
{% endblock %}

{% block content %}
<div class="form-container">
  <h1>Staples - Time Cost</h1>
  <p>
    Add staple items and their costs. Using your hourly rate, this page estimates how many work hours
    it takes to earn each item.
  </p>

  <div>
    <label for="stapleHourlyRate">Your Hourly Rate ({{ currency }}):</label>
    <input type="number" step="0.01" id="stapleHourlyRate"
           value="{{ hourlyRate or '' }}"
           placeholder="Enter your hourly rate" required>
  </div>

  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Cost ({{ currency }})</th>
        <th>Time to Earn (hrs)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="stapleTableBody"></tbody>
    <tfoot>
      <tr>
        <td><strong>Total</strong></td>
        <td><strong id="totalCost">0.00</strong></td>
        <td><strong id="totalTime">0.00</strong></td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <button type="button" id="addStapleBtn">Add Item</button>
</div>
{% endblock %}
